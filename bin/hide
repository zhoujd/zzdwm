#!/bin/bash
# hide windows

gap=${WINGAP:-5}

focus() {
    local id=$1
    xdotool windowactivate $id
    xdotool windowraise $id
    xdotool windowfocus $id
}

prepare() {
    local id=$1
    wmctrl -ir $id -b remove,maximized_vert,maximized_horz
}

setwin() {
    local id=$1
    local width=$(xwininfo -id $id | grep Width | cut -d: -f2 | tr -d ' ')
    local height=$(xwininfo -id $id | grep Height | cut -d: -f2 | tr -d ' ')
    local y=$(xwininfo -id $id | grep Absolute | grep Y: | awk '{print $4}')
    prepare $id
    xdotool windowmove $id $((-2*$width)) $y
}

main() {
    local desktop=$(xdotool get_desktop)
    local id=$(xdotool getactivewindow)
    local windows=($(wmctrl -xl 2>/dev/null | grep -E "\s+${desktop}\s+" | \
                         tr -s '[:blank:]' |  awk '{print $1}'))
    if [ -z "$id" ]; then
        id=${windows[0]}
    fi
    for win in ${windows[@]}; do
        if [[ $win -ne $id ]]; then
            setwin $win
        fi
    done
    setwin $id
    focus $id
}

main $@
