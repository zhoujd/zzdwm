#!/bin/bash
# Deck windows

gap=5

deck() {
    local act=$1
    local id=$2
    local mw=$(xwininfo -root | grep Width | cut -d: -f2 | tr -d ' ')
    local mh=$(xwininfo -root | grep Height | cut -d: -f2 | tr -d ' ')
    local fw=$(( $mw - $gap*2  ))
    local fh=$(( $mh - $gap*2  ))
    local hw=$(( ($mw - $gap*3) / 2 ))
    local hh=$(( ($mh - $gap*3) / 2 ))
    case $act in
        --help|-h )
            echo "Usage: $(basename $0) {left|top|right|bottom|--help|-h}"
            ;;
        left )
            xdotool windowmove $id $gap $gap
            xdotool windowsize $id $hw $fh
            ;;
        top )
            xdotool windowmove $id $gap $gap
            xdotool windowsize $id $fw $hh
            ;;
        right )
            xdotool windowmove $id $(( $mw/2 + $gap/2 )) $gap
            xdotool windowsize $id $hw $fh
            ;;
        bottom )
            xdotool windowmove $id $gap $(( $mh/2 + $gap/2 ))
            xdotool windowsize $id $fw $hh
            ;;
        * )
            xdotool windowmove $id $(( $mw/4 )) $(( $mh/4 ))
            xdotool windowsize $id $hw $hh
            ;;
    esac
}

main() {
    local kind=$1
    local desktop=$(xdotool get_desktop)
    local focus=$(xprop -root | grep '^_NET_ACTIVE_W' | awk '{print $5}')
    local windows=($(wmctrl -xl 2>/dev/null | grep -E "\s+${desktop}\s+" | \
                         tr -s '[:blank:]' |  awk '{print $1}'))
    case $kind in
        v )
            for win in ${windows[@]}; do
                if [[ $win -eq $focus ]]; then
                    deck left $win
                else
                    deck right $win
                fi
            done
            ;;
        h )
            for win in ${windows[@]}; do
                if [[ $win -eq $focus ]]; then
                    deck top $win
                else
                    deck bottom $win
                fi
            done
            ;;
        * )
            echo "$(basename $0) {v|h}"
            ;;
    esac
}

main $@
