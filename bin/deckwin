#!/bin/bash
# Dock a window to the side of a screen.

gap=5

focus() {
    local id=$1
    xdotool windowactivate $id
    xdotool windowraise $id
    xdotool windowfocus $id
}

prepare() {
    local id=$1
    wmctrl -ir $id -b remove,maximized_vert,maximized_horz
}

main() {
    local kind=$1
    local id=$(xdotool getactivewindow)
    local mw=$(xwininfo -root | grep Width | cut -d: -f2 | tr -d ' ')
    local mh=$(xwininfo -root | grep Height | cut -d: -f2 | tr -d ' ')
    local fw=$(( $mw - $gap*2  ))
    local fh=$(( $mh - $gap*2  ))
    local hw=$(( ($mw - $gap*3) / 2 ))
    local hh=$(( ($mh - $gap*3) / 2 ))

    case $kind in
        --help|-h )
            echo "Usage: $(basename $0) {left|top|right|bottom|--help|-h}"
            ;;
        left )
            prepare $id
            xdotool windowmove $id $gap $gap
            xdotool windowsize $id $hw $fh
            focus $id
            ;;
        top )
            prepare $id
            xdotool windowmove $id $gap $gap
            xdotool windowsize $id $fw $hh
            focus $id
            ;;
        right )
            prepare $id
            xdotool windowmove $id $(( $mw/2 + $gap/2 )) $gap
            xdotool windowsize $id $hw $fh
            focus $id
            ;;
        bottom )
            prepare $id
            xdotool windowmove $id $gap $(( $mh/2 + $gap/2 ))
            xdotool windowsize $id $fw $hh
            focus $id
            ;;
        * )
            ## Prepare window
            prepare $id
            ## Reset window
            xdotool windowmove $id $(( $mw/4 )) $(( $mh/4 ))
            xdotool windowsize $id $hw $hh
            ## Reset focus
            focus $id
            ;;
    esac
}

main $@
