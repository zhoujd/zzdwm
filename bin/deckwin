#!/bin/bash
# Dock a window to the side of a screen.

gap=${WINGAP:-5}

focus() {
    local id=$1
    xdotool windowactivate $id
    xdotool windowraise $id
    xdotool windowfocus $id
}

prepare() {
    local id=$1
    wmctrl -ir $id -b remove,maximized_vert,maximized_horz
}

setwin() {
    local id=$1
    local pos_x=$2
    local pos_y=$3
    local size_x=$4
    local size_y=$5
    xdotool windowmove $id $pos_x $pos_y
    xdotool windowsize $id $size_x $size_y
}

main() {
    local kind=$1
    local id=$(xdotool getactivewindow)
    local mw=$(xwininfo -root | grep Width | cut -d: -f2 | tr -d ' ')
    local mh=$(xwininfo -root | grep Height | cut -d: -f2 | tr -d ' ')
    local fw=$(($mw-$gap*2))
    local fh=$(($mh-$gap*2))
    local hw=$((($mw-$gap*3)/2))
    local hh=$((($mh-$gap*3)/2))

    case $kind in
        --help|-h )
            echo "usage: $(basename $0) {left|top|right|bottom|--help|-h}"
            ;;
        left )
            prepare $id
            setwin $id $gap $gap $hw $fh
            focus $id
            ;;
        top )
            prepare $id
            setwin $id $gap $gap $fw $hh
            focus $id
            ;;
        right )
            prepare $id
            setwin $id $(($mw/2+$gap/2)) $gap $hw $fh
            focus $id
            ;;
        bottom )
            prepare $id
            setwin $id $gap $(($mh/2+$gap/2)) $fw $hh
            focus $id
            ;;
        * )
            ## Prepare window
            prepare $id
            ## Set window
            setwin $id $(($mw/8)) $(($mh/8)) $(($hw*3/2)) $(($hh*3/2))
            ## Set focus
            focus $id
            ;;
    esac
}

main $@
