#!/bin/bash

TERM_CMD="st"
PID=$(xprop -id "$(xprop -root | \
       awk '/_NET_ACTIVE_WINDOW\(WINDOW\)/{print $NF}')" | \
       grep -m 1 PID | \
       cut -d " " -f 3)
PID=$(pstree -lpA "$PID" | \
       tail -n 1 | awk -F'---' '{print $NF}' | \
       sed -re 's/[^0-9]//g')
PCWD=$(readlink /proc/"$PID"/cwd)
PCMDLINE=$(cat /proc/"$PID"/cmdline | tr '\0' ' ' | \
            sed -e 's/[[:space:]]*$//')
PCMD=$(echo "$PCMDLINE" | awk '{print $1}')
case $PCMD in
    ssh )
        exec $TERM_CMD -e $PCMDLINE
        ;;
    * )
        exec $TERM_CMD -d $PCWD
        ;;
esac
