#!/bin/bash

title="info:"
lines=10
desktop=$(xdotool get_desktop)
active=$(xprop -root | grep '^_NET_ACTIVE_W' | awk -F'# 0x' '{print $2}')
windows=$(wmctrl -xl 2>/dev/null | grep -E "\s+${desktop}\s+")
apps=$(echo -n "$windows" | tr -s '[:blank:]' | cut -d ' ' -f 1-3,5- | \
           grep ${active} | sed 's/[a-zA-Z0-9-]*\.//' | \
           sed -r "s/0x.*${active}(\s+)//")
wm=$(wmctrl -m | grep Name: | awk '{print $2}')

mkdesktop() {
    local labels=(one two three four five six seven eight nine)
    case $wm in
        dwm ) echo ${labels[$desktop]} ;;
        CWM ) echo ${labels[(($desktop-1))]} ;;
        * ) echo "" ;;
    esac
}

mkgeometry() {
    local kind=$1
    local id=$(xdotool getactivewindow)
    if [ -n "$id" ]; then
        xdotool getwindowgeometry --shell $id | grep $kind | cut -d= -f2
    else
        xdotool getdisplaygeometry --shell | grep $kind | cut -d= -f2
    fi
}

opt=(
    -l $lines
    -i
    -p $title
)

cat <<EOF | dmenu ${opt[@]}
desktop - $(mkdesktop)
class   - $(echo $apps | awk '{print $2}')
title   - $(echo $apps | cut -d ' ' -f 3-)
x       - $(mkgeometry 'X')
y       - $(mkgeometry 'Y')
width   - $(mkgeometry 'WIDTH')
height  - $(mkgeometry 'HEIGHT')
screen  - $(mkgeometry 'SCREEN')
WM      - ${wm}
EOF
